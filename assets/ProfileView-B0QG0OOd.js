import{d as T,m as x,i as j,o as l,c as n,a as t,E as P,t as d,s as o,G as F,w as h,v as y,x as c,D as N,_ as G,g as H,h as O,k as R,q as C,A as I,z as J,H as S,F as K,r as Q,y as $}from"./index-BP76MkKj.js";import{a as W,b as X,c as Y,_ as Z}from"./TicketList.vue_vue_type_script_setup_true_lang-C904KDYD.js";const ee={class:"bg-zinc-800 p-8 rounded-3xl shadow-2xl border border-[#ff7f50] text-white space-y-8"},te={class:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-lg text-gray-200"},oe={key:0,class:"text-green-400 mt-4 text-sm"},se={key:1,class:"text-red-400 mt-4 text-sm"},le=T({__name:"UserDetails",props:{modelValue:{}},emits:["update:modelValue"],setup(E,{emit:m}){const w=E,k=m,s=x({...w.modelValue}),{updateUserProfile:U,changeUserPassword:V}=j(),b=x(""),v=x(""),i=x(""),g=x(""),D=async()=>{try{await U({name:s.value.name,phone:s.value.phone,email:s.value.email}),i.value="Profile updated successfully!",g.value="",k("update:modelValue",s.value)}catch(p){i.value="",g.value=p.message}},_=async()=>{try{await V(b.value,v.value),i.value="Password changed successfully!",g.value="",b.value="",v.value=""}catch(p){i.value="",g.value=p.message}};return(p,e)=>(l(),n("div",ee,[t("div",te,[t("p",null,[e[5]||(e[5]=t("span",{class:"font-semibold text-[#ff7f50]"},"Name:",-1)),P(" "+d(s.value.name),1)]),t("p",null,[e[6]||(e[6]=t("span",{class:"font-semibold text-[#ff7f50]"},"Email:",-1)),P(" "+d(s.value.email),1)]),t("p",null,[e[7]||(e[7]=t("span",{class:"font-semibold text-[#ff7f50]"},"Phone:",-1)),P(" "+d(s.value.phone),1)]),t("p",null,[e[8]||(e[8]=t("span",{class:"font-semibold text-[#ff7f50]"},"Date of Birth:",-1)),P(" "+d(o(N)(s.value.dateOfBirth)),1)])]),t("div",null,[e[10]||(e[10]=t("h3",{class:"text-xl font-bold mb-3 text-[#ff7f50]"},"‚úèÔ∏è Update Profile",-1)),t("form",{onSubmit:F(D,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[h(t("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>s.value.name=u),type:"text",placeholder:"Name",class:"w-full p-3 bg-white border border-[#ff7f50] rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#ff7f50]"},null,512),[[y,s.value.name]]),h(t("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>s.value.phone=u),type:"text",placeholder:"Phone",class:"w-full p-3 bg-white border border-[#ff7f50] rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#ff7f50]"},null,512),[[y,s.value.phone]]),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=u=>s.value.email=u),type:"email",placeholder:"Email",class:"w-full p-3 bg-white border border-[#ff7f50] rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#ff7f50]"},null,512),[[y,s.value.email]]),e[9]||(e[9]=t("button",{type:"submit",class:"col-span-1 sm:col-span-2 bg-[#ff7f50] text-black font-semibold py-2 rounded-md hover:bg-orange-500 transition"}," Update Profile ",-1))],32)]),t("div",null,[e[12]||(e[12]=t("h3",{class:"text-xl font-bold mb-3 text-[#ff7f50]"},"üîí Change Password",-1)),t("form",{onSubmit:F(_,["prevent"]),class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},[h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=u=>b.value=u),type:"password",placeholder:"Current Password",class:"w-full p-3 bg-white border border-[#ff7f50] rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#ff7f50]"},null,512),[[y,b.value]]),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=u=>v.value=u),type:"password",placeholder:"New Password",class:"w-full p-3 bg-white border border-[#ff7f50] rounded-lg text-black placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-[#ff7f50]"},null,512),[[y,v.value]]),e[11]||(e[11]=t("button",{type:"submit",class:"col-span-1 sm:col-span-2 bg-[#ff7f50] text-black font-semibold py-2 rounded-md hover:bg-orange-500 transition"}," Change Password ",-1))],32)]),i.value?(l(),n("p",oe,d(i.value),1)):c("",!0),g.value?(l(),n("p",se,d(g.value),1)):c("",!0)]))}}),ae=G(le,[["__scopeId","data-v-d3f0fff7"]]),ne={class:"w-full bg-gradient-to-br from-black via-zinc-900 to-black bg-opacity-80 rounded-3xl shadow-2xl border border-[#ff7f50] p-10 text-white mt-8 max-w-6xl mx-auto space-y-8"},re={key:0,class:"text-center text-orange-300 text-xl font-semibold"},ie={key:1,class:"text-center text-red-400 text-xl font-semibold"},ue={key:3,class:"flex justify-center space-x-8 mb-6"},de={key:4,class:"text-center text-orange-300 text-xl font-semibold"},fe={key:5,class:"grid grid-cols-1 sm:grid-cols-2 gap-8"},ce={key:0,class:"text-orange-300"},ge={key:1,class:"text-red-400"},pe={key:6,class:"text-center text-gray-300 text-lg"},xe=T({__name:"ProfileView",setup(E){const{bookings:m,loading:w,error:k,fetchUserBookings:s,cancelBooking:U}=H(),{fetchFlightById:V,loading:b,error:v}=O(),{user:i,fetchUserProfile:g,loading:D,error:_}=j(),p=x({}),e=x("upcoming");R(async()=>{await g(),await s(),await u()});async function u(){const f=[...new Set(m.value.flatMap(a=>a.tickets.map(r=>r.flight_id)))];for(const a of f)if(!p.value[a])try{p.value[a]=await V(a)}catch{}}const L=new Date,M=C(()=>m.value.filter(f=>new Date(f.tickets[0].departureDate)>=L)),z=C(()=>m.value.filter(f=>new Date(f.tickets[0].departureDate)<L)),B=C(()=>e.value==="upcoming"?M.value:z.value);function q(f){return p.value[f]??void 0}async function A(f){confirm("Cancel this booking?")&&await U(f)}return(f,a)=>(l(),n("section",ne,[a[3]||(a[3]=t("h1",{class:"text-5xl font-extrabold text-center tracking-wide text-[#ff7f50] mb-6"}," üë§ My Profile ",-1)),o(D)?(l(),n("div",re," üîÑ Loading your profile... ")):c("",!0),o(_)&&o(k)?(l(),n("div",ie," ‚ùó "+d(o(_)||o(k)),1)):c("",!0),o(i)?(l(),I(ae,{key:2,modelValue:o(i),"onUpdate:modelValue":a[0]||(a[0]=r=>J(i)?i.value=r:null)},null,8,["modelValue"])):c("",!0),o(m).length?(l(),n("div",ue,[t("button",{onClick:a[1]||(a[1]=r=>e.value="upcoming"),class:S(["px-4 py-2 rounded-full font-semibold transition duration-200",e.value==="upcoming"?"bg-[#ff7f50] text-black shadow-lg":"text-white hover:text-orange-300"])}," Upcoming ("+d(M.value.length)+") ",3),t("button",{onClick:a[2]||(a[2]=r=>e.value="past"),class:S(["px-4 py-2 rounded-full font-semibold transition duration-200",e.value==="past"?"bg-[#ff7f50] text-black shadow-lg":"text-white hover:text-orange-300"])}," Past ("+d(z.value.length)+") ",3)])):c("",!0),o(w)?(l(),n("div",de," üîÑ Loading your bookings... ")):c("",!0),B.value.length?(l(),n("div",fe,[(l(!0),n(K,null,Q(B.value,r=>(l(),n("div",{key:r._id,class:"bg-zinc-800 p-6 rounded-2xl shadow-inner flex flex-col space-y-4 border border-zinc-700"},[$(Z,{booking:r,showId:!0,showCancelButton:!0,onCancel:A},null,8,["booking"]),$(W,{booking:r,formatDate:o(N)},null,8,["booking","formatDate"]),o(b)?(l(),n("div",ce," üîÑ Loading flight details... ")):c("",!0),o(v)?(l(),n("div",ge,"‚ùó "+d(o(v)),1)):(l(),I(X,{key:2,ticket:r.tickets[0],flight:q(r.tickets[0].flight_id),formatDate:o(N)},null,8,["ticket","flight","formatDate"])),$(Y,{tickets:r.tickets},null,8,["tickets"])]))),128))])):c("",!0),!o(w)&&o(m).length&&B.value.length===0?(l(),n("div",pe," No "+d(e.value)+" bookings. ",1)):c("",!0)]))}});export{xe as default};
