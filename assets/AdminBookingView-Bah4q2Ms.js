import{d as V,g as L,h as S,m as h,k as $,o as a,c as n,a as r,y as g,B as M,w as T,v as U,t as v,x as f,s as o,F as y,r as P,A as R,C as j,E as q,D as p}from"./index-h2x63-Jx.js";import{a as z,b as G,c as H,_ as J}from"./TicketList.vue_vue_type_script_setup_true_lang-C6MizJ3T.js";const K={class:"p-6"},O={class:"p-6"},Q={class:"mb-6 flex items-center gap-2"},W={key:0,class:"text-red-600 mb-4"},X={key:1,class:"text-blue-500 mb-4"},Y={key:2,class:"text-red-600 mb-4"},Z={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"},ee={key:0,class:"text-blue-500 mb-4"},te={key:1,class:"text-red-600 mb-4"},le=V({__name:"AdminBookingView",setup(ae){const{bookings:d,error:k,loading:x,fetchAllBookings:w,cancelBooking:B,fetchBookingsByEmail:D,fetchBookingById:C}=L(),{fetchFlightById:A,error:_,loading:E}=S(),u=h({}),c=h(""),s=h("");$(async()=>{await b()});async function b(){await w(),await m(d.value)}async function m(l){const i=[...new Set(l.flatMap(t=>t.tickets.map(e=>e.flight_id)))];for(const t of i)if(!u.value[t])try{const e=await A(t);e?u.value[t]=e:u.value[t]=null}catch{u.value[t]=null}}async function I(){if(!c.value.trim()){s.value="Please enter an email or booking ID.";return}if(s.value="",c.value.includes("@"))try{await D(c.value),d.value.length===0?s.value="No bookings found with that email.":await m(d.value)}catch(l){s.value=l.message}else try{const l=await C(c.value);d.value=[l],await m(d.value)}catch{s.value="No booking found with that ID."}}async function F(){c.value="",s.value="",u.value={},await b()}async function N(l){confirm("Are you sure you want to cancel this booking?")&&await B(l)}return(l,i)=>{const t=j("router-link");return a(),n(y,null,[r("div",K,[g(t,{to:"/admin",class:"inline-block mb-4 px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"},{default:M(()=>i[1]||(i[1]=[q(" ðŸ”™ Back to Admin ")])),_:1})]),r("div",O,[i[2]||(i[2]=r("h1",{class:"text-2xl font-bold mb-6"},"ðŸ“‹ Admin â€“ All Bookings",-1)),r("div",Q,[T(r("input",{"onUpdate:modelValue":i[0]||(i[0]=e=>c.value=e),type:"text",placeholder:"Search by User Email or Booking ID",class:"flex-1 text-black p-2 border rounded-md"},null,512),[[U,c.value]]),r("button",{onClick:I,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-md"}," Search "),r("button",{onClick:F,class:"bg-gray-300 hover:bg-gray-400 text-black px-4 py-2 rounded-md"}," Reset ")]),s.value?(a(),n("div",W,v(s.value),1)):f("",!0),o(x)?(a(),n("div",X,"Loading...")):f("",!0),o(k)?(a(),n("div",Y,v(o(k)),1)):f("",!0),r("div",Z,[(a(!0),n(y,null,P(o(d),e=>(a(),n("div",{key:e._id,class:"bg-black text-white border border-[#ff7f50] shadow-lg rounded-xl p-6 flex flex-col"},[g(J,{booking:e,showId:!0,showCancelButton:!0,onCancel:N},null,8,["booking"]),g(z,{booking:e,formatDate:o(p)},null,8,["booking","formatDate"]),o(E)?(a(),n("div",ee," Loading flight details... ")):f("",!0),o(_)?(a(),n("div",te,v(o(_)),1)):(a(),R(G,{key:2,ticket:e.tickets[0],flight:u.value[e.tickets[0].flight_id],formatDate:o(p)},null,8,["ticket","flight","formatDate"])),g(H,{tickets:e.tickets},null,8,["tickets"])]))),128))])])],64)}}});export{le as default};
