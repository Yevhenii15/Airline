import{d as E,u as X,o as c,c as p,r as Y,a as e,w as x,v as N,b as Z,F as ee,e as te,f as se,g as le,h as ae,i as oe,j as re,k as y,l as ne,m as S,n as ie,p as D,q as de,s,t as i,x as v,y as O,z as ue}from"./index-h2x63-Jx.js";import{S as me}from"./SeatMap-BPC7pkAj.js";const fe={class:"grid gap-4 md:grid-cols-2"},ce=["onUpdate:modelValue"],pe=["onUpdate:modelValue"],be=["onUpdate:modelValue"],ge=["onUpdate:modelValue"],xe={class:"md:col-span-2"},ve=["onUpdate:modelValue"],he=E({__name:"PassengerForm",props:{modelValue:{},modelModifiers:{}},emits:["update:modelValue"],setup(U){const P=X(U,"modelValue");return(V,a)=>(c(!0),p(ee,null,Y(P.value,(o,h)=>(c(),p("div",{key:h,class:"p-6 rounded-2xl mt-6 bg-[#181818] shadow-lg border border-[#ff7f50] transition-transform hover:scale-[1.01]"},[e("div",fe,[e("div",null,[a[0]||(a[0]=e("label",{class:"block text-sm text-white mb-1"},"First Name",-1)),x(e("input",{"onUpdate:modelValue":r=>o.firstName=r,placeholder:"First Name",class:"w-full p-3 border bg-white border-[#ff7f50] rounded-lg text-black placeholder:text-gray-400",required:""},null,8,ce),[[N,o.firstName]])]),e("div",null,[a[1]||(a[1]=e("label",{class:"block text-sm text-white mb-1"},"Last Name",-1)),x(e("input",{"onUpdate:modelValue":r=>o.lastName=r,placeholder:"Last Name",class:"w-full p-3 border bg-white border-[#ff7f50] rounded-lg text-black placeholder:text-gray-400",required:""},null,8,pe),[[N,o.lastName]])]),e("div",null,[a[3]||(a[3]=e("label",{class:"block text-sm text-white mb-1"},"Gender",-1)),x(e("select",{"onUpdate:modelValue":r=>o.gender=r,class:"w-full p-3 border bg-white border-[#ff7f50] rounded-lg text-black"},a[2]||(a[2]=[e("option",{value:"Male",class:"text-black"},"Male",-1),e("option",{value:"Female",class:"text-black"},"Female",-1)]),8,be),[[Z,o.gender]])]),e("div",null,[a[4]||(a[4]=e("label",{class:"block text-sm text-white mb-1"},"Seat Number",-1)),x(e("input",{"onUpdate:modelValue":r=>o.seatNumber=r,placeholder:"Seat Number",class:"w-full p-3 border bg-white border-[#ff7f50] rounded-lg text-black",disabled:""},null,8,ge),[[N,o.seatNumber]])]),e("div",xe,[a[5]||(a[5]=e("label",{class:"block text-sm text-white mb-1"},"Ticket Price",-1)),x(e("input",{"onUpdate:modelValue":r=>o.ticketPrice=r,type:"number",class:"w-full p-3 border bg-white border-[#ff7f50] rounded-lg text-black",disabled:""},null,8,ve),[[N,o.ticketPrice,void 0,{number:!0}]])])])]))),128))}}),ke={class:"max-w-4xl mx-auto p-6 bg-black shadow-2xl my-10 rounded-2xl border border-[#ff7f50]"},we={key:0,class:"mb-10 p-6 bg-[#181818] rounded-xl border border-[#ff7f50]"},_e={class:"flex gap-4 text-white text-base"},Ne={class:"w-1/2"},ye={class:"ml-2"},Se={class:"ml-2"},Pe={class:"ml-2"},Ve={class:"ml-2"},De={class:"ml-2"},Ue={class:"ml-2"},Fe={class:"ml-2"},Be={class:"ml-2"},Te={key:1,class:"mb-8"},$e={key:2,class:"text-[#ff7f50] font-medium mt-4 text-center"},Me={key:3},qe={class:"mt-8 flex justify-between items-center bg-[#181818] p-4 rounded-lg border border-[#ff7f50]"},Ie={class:"text-white font-bold text-xl"},Ae=["disabled"],Le={key:4,class:"text-red-500 mt-4 text-center font-medium"},Re=E({__name:"BookingView",setup(U){const P=te(),{airportNameMap:V,fetchAirports:a}=se(),{createBooking:o,loading:h,error:r,selectedFlightData:d,disabledDates:R,formatLocalDate:F}=le(),{loading:Ce,flights:B,fetchFlights:j}=ae(),{getTokenAndUserId:T}=oe(),{getBookedSeats:z,bookedSeats:G,selectedSeats:$,numberOfPassengers:k,tickets:u,availableSeats:J,handleSeatSelect:H}=re();y(()=>{a()});const g=ne();y(()=>{g.query.flight&&(f.value=g.query.flight),g.query.date&&(b.value=new Date(g.query.date)),g.query.passengers&&(k.value=parseInt(g.query.passengers))});const K=S(null),f=S(null),b=S(void 0),w=S(!1);y(()=>{try{const{userId:l}=T();K.value=l}catch{}}),y(()=>j()),ie(()=>{if(!f.value||B.value.length===0)return;const l=B.value.find(t=>t._id===f.value);l&&(d.value=l,u.value.forEach(t=>{t.ticketPrice=l.basePrice||0}))}),D([f,b],async([l,t])=>{if(l&&t instanceof Date){w.value=!0;const m=F(t);G.value=await z(l,m),w.value=!1}}),D(k,l=>{var m;const t=u.value.length;if(l>t)for(let n=0;n<l-t;n++)u.value.push({firstName:"",lastName:"",gender:"Male",seatNumber:"",ticketPrice:((m=d.value)==null?void 0:m.basePrice)||0});else u.value.splice(l)});const M=de(()=>u.value.reduce((l,t)=>l+t.ticketPrice,0)),Q=async()=>{if(!f.value||!b.value){alert("Please select a flight and a valid date");return}try{const{userId:l,email:t}=T(),m={user_id:l||"",user_email:t||"",totalPrice:M.value,bookingDate:new Date().toISOString(),numberOfTickets:u.value.length,bookingStatus:"Confirmed",tickets:u.value.map((n,_)=>({ticket_id:`T100${_+1}`,firstName:n.firstName,lastName:n.lastName,ticketPrice:n.ticketPrice,gender:n.gender,seatNumber:n.seatNumber,flight_id:f.value,departureDate:F(b.value)}))};await o(m),localStorage.setItem("latestBooking",JSON.stringify(m)),P.push("/booking-confirmation")}catch{alert("Booking failed. Please try again.")}};return D(R,()=>{}),(l,t)=>{var m,n,_,q,I,A,L,C;return c(),p("div",ke,[f.value&&b.value&&s(k)?(c(),p("div",we,[t[9]||(t[9]=e("h3",{class:"text-3xl font-semibold text-[#ff7f50] mb-6 text-center tracking-wide"}," Flight Details ",-1)),e("div",_e,[e("div",Ne,[e("p",null,[t[1]||(t[1]=e("span",{class:"font-medium text-lg"},"Flight Number:",-1)),e("span",ye,i((m=s(d))==null?void 0:m.flightNumber),1)]),e("p",null,[t[2]||(t[2]=e("span",{class:"font-medium text-lg"},"From:",-1)),e("span",Se,i(((_=(n=s(d))==null?void 0:n.route)==null?void 0:_.departureAirport_id)&&s(V)[s(d).route.departureAirport_id]||"Unknown"),1)]),e("p",null,[t[3]||(t[3]=e("span",{class:"font-medium text-lg"},"To:",-1)),e("span",Pe,i(((I=(q=s(d))==null?void 0:q.route)==null?void 0:I.arrivalAirport_id)&&s(V)[s(d).route.arrivalAirport_id]||"Unknown"),1)]),e("p",null,[t[4]||(t[4]=e("span",{class:"font-medium text-lg"},"Date:",-1)),e("span",Ve,i(b.value.toLocaleDateString()),1)])]),e("div",null,[e("p",null,[t[5]||(t[5]=e("span",{class:"font-medium text-lg"},"Departure Time:",-1)),e("span",De,i((A=s(d))==null?void 0:A.departureTime),1)]),e("p",null,[t[6]||(t[6]=e("span",{class:"font-medium text-lg"},"Arrival Time:",-1)),e("span",Ue,i((L=s(d))==null?void 0:L.arrivalTime),1)]),e("p",null,[t[7]||(t[7]=e("span",{class:"font-medium text-lg"},"Passengers:",-1)),e("span",Fe,i(s(k)),1)]),e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium text-lg"},"Base Price:",-1)),e("span",Be,"$"+i((C=s(d))==null?void 0:C.basePrice),1)])])])])):v("",!0),t[12]||(t[12]=e("h2",{class:"text-2xl font-bold text-[#ff7f50] mb-4 text-center"}," Choose Seats ",-1)),f.value&&b.value&&!w.value?(c(),p("div",Te,[O(me,{"seat-map":s(J),"selected-seats":s($),onSelectSeat:s(H)},null,8,["seat-map","selected-seats","onSelectSeat"])])):v("",!0),w.value?(c(),p("p",$e," Loading seats... ")):v("",!0),s($).length>0?(c(),p("div",Me,[t[10]||(t[10]=e("h2",{class:"text-2xl font-bold text-[#ff7f50] mb-6 text-center"}," Passenger Info ",-1)),O(he,{modelValue:s(u),"onUpdate:modelValue":t[0]||(t[0]=W=>ue(u)?u.value=W:null)},null,8,["modelValue"])])):v("",!0),e("div",qe,[t[11]||(t[11]=e("h3",{class:"text-xl font-bold text-[#ff7f50]"},"Total Price",-1)),e("h3",Ie,"$"+i(M.value),1)]),e("button",{onClick:Q,disabled:s(h),class:"mt-8 w-full bg-[#22c55e] text-white text-lg font-semibold px-6 py-3 rounded-lg transition-all hover:bg-[#16a34a] disabled:bg-gray-500 disabled:cursor-not-allowed"},i(s(h)?"Processing...":"Confirm Booking"),9,Ae),s(r)?(c(),p("p",Le,i(s(r)),1)):v("",!0)])}}});export{Re as default};
